# Telemetry Data Model and Topic Contract

## 1. Introduction
This document describes the telemetry data model and MQTT topic structure used between IoT devices and the IoT Backend.

The goal is to define a clear and stable contract that allows devices, backend services, and data processors to interoperate reliably. 

## 2. Telemetry Data model
Each sensor publishes its measurements to a dedicated MQTT topic. This simplifies device firmware and topic-based routing at the cost of increased message volume and reduced measurement atomicity.

**Fields**
- value: sensor's measurement value. 
- unit: unit of the measurement.
- timestamp: ISO 8601 timestamp generated by the device.

**Naming convention**
- All field names uses snake_case.
- Measurement values are numeric unless stated otherwise.

### Example payload
```json
{
    "value": 24.04, "unit": "C", "timestamp": "2025-01-01T12:34:56Z"
}
```


## 3. Communication protocol
- **Protocol**: MQTT
- **Payload format:** JSON

## 4. MQTT Topic Structure
## Topic hierarchy

```
    iot/{site}/{location}/{device_id}/{measurement}
```

### Example

```
    iot/cottage/greenhouse/device-001/temperature
    iot/cottage/greenhouse/device-001/humidity
```

### Topic types

**Measurement topics**
- `temperature`
- `humidity`
- `pressure`
- `voltage`

**Control & Lifecycle topics**
- `status` - Device lifecycle state (online/offline).
- `events` - Errors or warnings.
- `commands` - Backend-to-device messages

## 5. QoS and Delivery Semantics

- **QoS**: 1 (at-least-once-delivery)
- Consumers must tolerate duplicate messages
- Messages are not retained unless explicitly stated

## Design Rationale

A topic-per-measurement model was chosen to:
- Simplify device firmware
- Enable selective data forwarding to external systems
- Improve extensibility when adding new sensors
- Reduce payload redundancy by encoding metadata in topic hierarchy

This approach increases message volume and reduces measurement atomicity, which is acceptable for the intended deployment scale and learning goals of this project.
